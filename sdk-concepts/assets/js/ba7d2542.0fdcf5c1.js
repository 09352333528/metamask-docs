"use strict";(self.webpackChunkmetamask_docs=self.webpackChunkmetamask_docs||[]).push([[4442],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,p=r(e,["components","mdxType","originalType","parentName"]),d=c(n),u=o,h=d["".concat(l,".").concat(u)]||d[u]||m[u]||i;return n?a.createElement(h,s(s({ref:t},p),{},{components:n})):a.createElement(h,s({ref:t},p))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,s=new Array(i);s[0]=u;var r={};for(var l in t)hasOwnProperty.call(t,l)&&(r[l]=t[l]);r.originalType=e,r[d]="string"==typeof e?e:o,s[1]=r;for(var c=2;c<i;c++)s[c]=n[c];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},53999:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>m,frontMatter:()=>i,metadata:()=>r,toc:()=>c});var a=n(87462),o=(n(67294),n(3905));const i={sidebar_position:1,sidebar_label:"SDK connections"},s="MetaMask SDK connections",r={unversionedId:"concepts/sdk/connections",id:"concepts/sdk/connections",title:"MetaMask SDK connections",description:"Connection flow",source:"@site/wallet/concepts/sdk/connections.md",sourceDirName:"concepts/sdk",slug:"/concepts/sdk/connections",permalink:"/sdk-concepts/wallet/concepts/sdk/connections",draft:!1,editUrl:"https://github.com/MetaMask/metamask-docs/edit/main/wallet/concepts/sdk/connections.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,sidebar_label:"SDK connections"},sidebar:"walletSidebar",previous:{title:"About MetaMask SDK",permalink:"/sdk-concepts/wallet/concepts/sdk/"},next:{title:"Android SDK architecture",permalink:"/sdk-concepts/wallet/concepts/sdk/android"}},l={},c=[{value:"Connection flow",id:"connection-flow",level:2},{value:"Dapp MetaMask Mobile encrypted connection",id:"dapp-metamask-mobile-encrypted-connection",level:3},{value:"Connection status",id:"connection-status",level:2},{value:"Paused connections",id:"paused-connections",level:3},{value:"Cleared connections",id:"cleared-connections",level:3},{value:"Close connections manually",id:"close-connections-manually",level:4}],p={toc:c},d="wrapper";function m(e){let{components:t,...n}=e;return(0,o.kt)(d,(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"metamask-sdk-connections"},"MetaMask SDK connections"),(0,o.kt)("h2",{id:"connection-flow"},"Connection flow"),(0,o.kt)("p",null,"The connection flow between the SDK and MetaMask Mobile depends on the device the dapp is on:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"The dapp and MetaMask Mobile are on different devices (for example, a desktop web dapp):"),(0,o.kt)("ol",{parentName:"li"},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"The dapp shows a modal where the user is asked to select if they want to connect to MetaMask using\nthe browser extension or MetaMask Mobile.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"If the user selects extension:"),(0,o.kt)("ol",{parentName:"li"},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"If the extension is not installed, the user is taken to the Chrome extension store where the\nextension can be downloaded/installed.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"If it's already installed then the flow continues at it would normally do with MM Extension.")))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"If user selects MM Mobile app:"),(0,o.kt)("ol",{parentName:"li"},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"If the MM mobile app is not installed, the user is taken to the Apple/Google app stores to\ndownload and install it.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"If the MM mobile app is already installed, the connection is established as described in\nthe paragraph below."))))),(0,o.kt)("admonition",{parentName:"li",type:"note"},(0,o.kt)("p",{parentName:"admonition"},"The choice between MM Extension and MM mobile app is persisted unless the user or the dapp disconnects. At that point the user is again shown with the modal asking to select which client to use."))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Dapp and MetaMask Mobile are on the same device (for example, a mobile web dapp or mobile dapp):"),(0,o.kt)("ol",{parentName:"li"},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Dapp deeplinks to MM Mobile app:"),(0,o.kt)("ol",{parentName:"li"},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"If the MM mobile app is not installed, the user is taken to the Apple/Google app stores to\ndownload and install it.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"If the MM mobile app is already installed, the connection is established as described in\nthe paragraph below."))))))),(0,o.kt)("h3",{id:"dapp-metamask-mobile-encrypted-connection"},"Dapp MetaMask Mobile encrypted connection"),(0,o.kt)("p",null,"When mobile connection is selected this is how the encrypted connection is established:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Dapp generates a UUID v4 (Socket.io room id)"),(0,o.kt)("li",{parentName:"ol"},"Dapp generates a ECIES key pair"),(0,o.kt)("li",{parentName:"ol"},"Dapp connects to Socket.io server on room id"),(0,o.kt)("li",{parentName:"ol"},"Dapp shows QRCode/sends deep link with public key and room id"),(0,o.kt)("li",{parentName:"ol"},"MM Mobile app opens QRCode/deeplink"),(0,o.kt)("li",{parentName:"ol"},"MM Mobile app connects to Socket.io room id"),(0,o.kt)("li",{parentName:"ol"},"MM Mobile app generates ECIES key pair"),(0,o.kt)("li",{parentName:"ol"},"ECIES Keys Exchange"),(0,o.kt)("li",{parentName:"ol"},"Encrypted communication starts (RPC Methods, etc)\n\u200b\nOn Android SDK, the socket.io communication is not used but there's a direct (encrypted) local communication between the mobile app using the Android SDK and the MM mobile app. Read more on Android SDK documentation.")),(0,o.kt)("p",null,"The SDK uses elliptic curve integrated encryption scheme (ECIES) to communicate with MetaMask Mobile.\nECIES is a hybrid encryption scheme that combines the benefits of both symmetric and asymmetric encryption.\nIt's a secure method of exchanging encrypted messages between two parties."),(0,o.kt)("p",null,"In ECIES, the sender (your dapp) generates a shared secret using the recipient's (MetaMask Mobile's)\npublic key and their own private key.\nThe shared secret is used to encrypt the message using a symmetric cipher (the SDK uses ",(0,o.kt)("inlineCode",{parentName:"p"},"AES-256-GCM"),").\nThe encrypted message is then combined with a message authentication code (MAC) and sent to the recipient."),(0,o.kt)("p",null,"MetaMask Mobile uses its private key and the dapp's public key to recreate the shared secret and\ndecrypt the message.\nThe MAC is used to verify the authenticity of the message."),(0,o.kt)("p",null,"One of the main benefits of ECIES is that it allows the sender and recipient to exchange messages\nwithout having to exchange a shared secret beforehand.\nIt also provides security against eavesdropping and tampering, since the shared secret is derived\nfrom the sender's and recipient's private keys, which are both kept secret."),(0,o.kt)("h2",{id:"connection-status"},"Connection status"),(0,o.kt)("p",null,"The connection between the SDK and MetaMask Mobile can ",(0,o.kt)("a",{parentName:"p",href:"#paused-connections"},"pause")," and\n",(0,o.kt)("a",{parentName:"p",href:"#cleared-connections"},"clear"),"."),(0,o.kt)("h3",{id:"paused-connections"},"Paused connections"),(0,o.kt)("p",null,"Connections pause after MetaMask Mobile is in background (minimized) for 20 seconds.\nThis is to accommodate OS restrictions."),(0,o.kt)("p",null,"When a connection pauses, all traffic to MetaMask Mobile pauses, and the SDK doesn't produce any\nresponse until the user opens MetaMask Mobile again.\nThe SDK automatically deeplinks to MetaMask Mobile, so connections resume automatically.\nIf MetaMask Mobile is paused and the user completely closes MetaMask Mobile, the connection remains\npaused and resumes when the user opens it again."),(0,o.kt)("p",null,"Because of this, polling data from MetaMask Mobile may not work for long periods of time."),(0,o.kt)("admonition",{title:"known issue",type:"info"},(0,o.kt)("p",{parentName:"admonition"},"When MetaMask Mobile is running in the background, the connection may pause and fail to resume properly when the user reopens MetaMask.\nThe user must return to your dapp so the request is re-sent.\nThe SDK team is working on this issue, and is researching decentralized communication solutions that\nhold state such as ",(0,o.kt)("a",{parentName:"p",href:"https://waku.org/"},"Waku"),".")),(0,o.kt)("h3",{id:"cleared-connections"},"Cleared connections"),(0,o.kt)("p",null,"Connections clear if the user closes or refreshes your dapp, since MetaMask doesn't persist\nconnections on the dapp side.\nThis is for simplicity and security purposes."),(0,o.kt)("p",null,"If the user completely closes MetaMask Mobile without ",(0,o.kt)("a",{parentName:"p",href:"#paused-connections"},"pausing the connection"),"\nfirst, MetaMask infers that the user isn't using the wallet and closes the connection."),(0,o.kt)("h4",{id:"close-connections-manually"},"Close connections manually"),(0,o.kt)("p",null,"To close connections manually from MetaMask Mobile, go to ",(0,o.kt)("strong",{parentName:"p"},"Settings > Experimental"),", and select\n",(0,o.kt)("strong",{parentName:"p"},"Clear MetaMask SDK connections"),"."))}m.isMDXComponent=!0}}]);