"use strict";(self.webpackChunkmetamask_docs=self.webpackChunkmetamask_docs||[]).push([[1320],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>c});var i=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},s=Object.keys(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=i.createContext({}),l=function(e){var t=i.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},u=function(e){var t=l(e.components);return i.createElement(p.Provider,{value:t},e.children)},g="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},h=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,s=e.originalType,p=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),g=l(n),h=a,c=g["".concat(p,".").concat(h)]||g[h]||d[h]||s;return n?i.createElement(c,r(r({ref:t},u),{},{components:n})):i.createElement(c,r({ref:t},u))}));function c(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var s=n.length,r=new Array(s);r[0]=h;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o[g]="string"==typeof e?e:a,r[1]=o;for(var l=2;l<s;l++)r[l]=n[l];return i.createElement.apply(null,r)}return i.createElement.apply(null,n)}h.displayName="MDXCreateElement"},41022:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>r,default:()=>d,frontMatter:()=>s,metadata:()=>o,toc:()=>l});var i=n(87462),a=(n(67294),n(3905));const s={description:"Provide insights to your users in MetaMask's signature confirmation flow.",sidebar_position:10},r="Provide signature insights",o={unversionedId:"how-to/provide-signature-insights",id:"how-to/provide-signature-insights",title:"Provide signature insights",description:"Provide insights to your users in MetaMask's signature confirmation flow.",source:"@site/snaps/how-to/provide-signature-insights.md",sourceDirName:"how-to",slug:"/how-to/provide-signature-insights",permalink:"/zs/signature-insights-docs/snaps/how-to/provide-signature-insights",draft:!1,editUrl:"https://github.com/MetaMask/metamask-docs/edit/main/snaps/how-to/provide-signature-insights.md",tags:[],version:"current",sidebarPosition:10,frontMatter:{description:"Provide insights to your users in MetaMask's signature confirmation flow.",sidebar_position:10},sidebar:"snapsSidebar",previous:{title:"Troubleshoot",permalink:"/zs/signature-insights-docs/snaps/how-to/troubleshoot"},next:{title:"Concepts",permalink:"/zs/signature-insights-docs/snaps/concepts"}},p={},l=[{value:"Steps",id:"steps",level:2},{value:"1. Request permission to display signature insights",id:"1-request-permission-to-display-signature-insights",level:3},{value:"2. Implement <code>onSignature</code> and export it from <code>index.ts</code>",id:"2-implement-onsignature-and-export-it-from-indexts",level:3},{value:"eth_sign",id:"eth_sign",level:4},{value:"personal_sign",id:"personal_sign",level:4},{value:"eth_signTypedData",id:"eth_signtypeddata",level:4},{value:"eth_signTypedData_v3",id:"eth_signtypeddata_v3",level:4},{value:"eth_signTypedData_v4",id:"eth_signtypeddata_v4",level:4},{value:"Reference",id:"reference",level:2}],u={toc:l},g="wrapper";function d(e){let{components:t,...s}=e;return(0,a.kt)(g,(0,i.Z)({},u,s,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"provide-signature-insights"},"Provide signature insights"),(0,a.kt)("admonition",{type:"flaskOnly"}),(0,a.kt)("p",null,"Similarly to ",(0,a.kt)("a",{parentName:"p",href:"/zs/signature-insights-docs/snaps/tutorials/transaction-insights"},"providing transaction insights"),", Snaps allows you to provide signature insights to your users."),(0,a.kt)("h2",{id:"steps"},"Steps"),(0,a.kt)("h3",{id:"1-request-permission-to-display-signature-insights"},"1. Request permission to display signature insights"),(0,a.kt)("p",null,"To display signature insights to your users, you first need to add the ",(0,a.kt)("a",{parentName:"p",href:"/zs/signature-insights-docs/snaps/reference/permissions#endowmentsignature-insight"},(0,a.kt)("inlineCode",{parentName:"a"},"endowment:signature-insight"))," permission to your Snap's manifest:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="snap.manifest.json"',title:'"snap.manifest.json"'},'{\n  "initialPermissions": {\n    "endowment:signature-insight": {}\n  }\n}\n')),(0,a.kt)("p",null,"Additionally, if you need to receive the origin of the signature request, you must add ",(0,a.kt)("inlineCode",{parentName:"p"},"allowSignatureOrigin")," to the permission object, and set it to ",(0,a.kt)("inlineCode",{parentName:"p"},"true"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="snap.manifest.json"',title:'"snap.manifest.json"'},'{\n  "initialPermissions": {\n    "endowment:signature-insight": {\n      "allowSignatureOrigin": true\n    }\n  }\n}\n')),(0,a.kt)("p",null,"When requesting the permission, this is how it will be displayed in the MetaMask UI when installing the Snap:"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Signature insights permission",src:n(55261).Z,width:"706",height:"1020"})),(0,a.kt)("h3",{id:"2-implement-onsignature-and-export-it-from-indexts"},"2. Implement ",(0,a.kt)("inlineCode",{parentName:"h3"},"onSignature")," and export it from ",(0,a.kt)("inlineCode",{parentName:"h3"},"index.ts")),(0,a.kt)("p",null,"The next step is for your Snap to export an ",(0,a.kt)("inlineCode",{parentName:"p"},"onSignature")," function. This function receives a ",(0,a.kt)("inlineCode",{parentName:"p"},"signature")," object. The shape of this object depends on the chain, as well as on the signing method used. This is why it's typed as ",(0,a.kt)("inlineCode",{parentName:"p"},"Record<string, unknown>"),"."),(0,a.kt)("p",null,"For Ethereum and Ethereum-compatible chains, the ",(0,a.kt)("inlineCode",{parentName:"p"},"signature")," object can have one of the following shapes, depending on the signging method used:"),(0,a.kt)("h4",{id:"eth_sign"},"eth_sign"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"interface EthSignature {\n  from: string;\n  data: string;\n  signatureMethod: 'eth_sign';\n}\n")),(0,a.kt)("h4",{id:"personal_sign"},"personal_sign"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"interface PersonalSignature {\n  from: string;\n  data: string;\n  signatureMethod: 'personal_sign';\n}\n")),(0,a.kt)("h4",{id:"eth_signtypeddata"},"eth_signTypedData"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"interface SignTypedDataSignature {\n  from: string;\n  data: Record<string, any>[];\n  signatureMethod: 'eth_signTypedData';\n}\n")),(0,a.kt)("h4",{id:"eth_signtypeddata_v3"},"eth_signTypedData_v3"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"interface SignTypedDataV3Signature {\n  from: string;\n  data: Record<string, any>;\n  signatureMethod: 'eth_signTypedData_v3';\n}\n")),(0,a.kt)("h4",{id:"eth_signtypeddata_v4"},"eth_signTypedData_v4"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"interface SignTypedDataV4Signature {\n  from: string;\n  data: Record<string, any>;\n  signatureMethod: 'eth_signTypedData_v4';\n}\n")),(0,a.kt)("p",null,"Your Snap should use ",(0,a.kt)("inlineCode",{parentName:"p"},"signatureMethod")," as the source of the truth to identify the signature scheme it is providing insights for."),(0,a.kt)("p",null,"Once you've identified the signature object, your Snap may run any logic it wants, including calling APIs. Then, your Snap must either return ",(0,a.kt)("inlineCode",{parentName:"p"},"null")," if it has no insights to provide, or an object with a ",(0,a.kt)("inlineCode",{parentName:"p"},"content")," property and an optional ",(0,a.kt)("inlineCode",{parentName:"p"},"severity")," property."),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"content")," object must be an instance of ",(0,a.kt)("a",{parentName:"p",href:"/zs/signature-insights-docs/snaps/how-to/use-custom-ui"},"Custom UI"),". The ",(0,a.kt)("inlineCode",{parentName:"p"},"severity"),", if provided, must be an instance of the ",(0,a.kt)("inlineCode",{parentName:"p"},"SeverityLevel")," enum exported by the ",(0,a.kt)("inlineCode",{parentName:"p"},"@metamask/snaps-sdk")," package. Currently the only severity level available is ",(0,a.kt)("inlineCode",{parentName:"p"},"SeverityLevel.Critical"),"."),(0,a.kt)("admonition",{type:"caution"},(0,a.kt)("p",{parentName:"admonition"},"Due to current MetaMask UI limitations, signature insights will only be displayed if your Snap's logic deems the signature to be one that a user shouldn't sign, that is if you return a severity level of ",(0,a.kt)("inlineCode",{parentName:"p"},"SeverityLevel.Critical"),".")),(0,a.kt)("p",null,"Here's an example implementation of ",(0,a.kt)("inlineCode",{parentName:"p"},"onSignature"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"import { OnSignatureHandler, SeverityLevel } from '@metamask/snaps-types';\nimport { panel, heading, text } from '@metamask/snaps-ui';\n\nexport const onSignature: OnSignatureHandler = async ({\n  signature,\n  signatureOrigin,\n}) => {\n  const insights = /* Get insights based on custom logic */;\n  return {\n    content: panel([\n      heading('My Signature Insights'),\n      text('Here are the insights:'),\n      ...(insights.map((insight) => text(insight.value)))\n    ]),\n    severity: SeverityLevel.Critical\n  };\n};\n")),(0,a.kt)("p",null,"When your Snap returns a signature insight with a ",(0,a.kt)("inlineCode",{parentName:"p"},"severity")," of ",(0,a.kt)("inlineCode",{parentName:"p"},"SeverityLevel.Critical"),', the Custom UI will be displayed in a modal after the user presses the "Sign" button, like so:'),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Signature insights warning",src:n(52168).Z,width:"708",height:"1164"})),(0,a.kt)("h2",{id:"reference"},"Reference"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/zs/signature-insights-docs/snaps/reference/permissions#endowmentsignature-insight"},(0,a.kt)("inlineCode",{parentName:"a"},"endowment:signature-insight"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/zs/signature-insights-docs/snaps/reference/exports#onsignature"},(0,a.kt)("inlineCode",{parentName:"a"},"onSignature")," export"))))}d.isMDXComponent=!0},55261:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/signature-insights-permission-03b009ee6a0b0d75ebb19e0608def03d.png"},52168:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/signature-insights-warning-a50a9d1c9223d9e3a79080398d28222a.png"}}]);