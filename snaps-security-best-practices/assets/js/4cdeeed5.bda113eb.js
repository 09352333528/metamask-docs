"use strict";(self.webpackChunkmetamask_docs=self.webpackChunkmetamask_docs||[]).push([[439],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>m});var n=a(67294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var l=n.createContext({}),p=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),u=p(a),h=i,m=u["".concat(l,".").concat(h)]||u[h]||d[h]||r;return a?n.createElement(m,s(s({ref:t},c),{},{components:a})):n.createElement(m,s({ref:t},c))}));function m(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=a.length,s=new Array(r);s[0]=h;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o[u]="string"==typeof e?e:i,s[1]=o;for(var p=2;p<r;p++)s[p]=a[p];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"},72199:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>r,metadata:()=>o,toc:()=>p});var n=a(87462),i=(a(67294),a(3905));const r={description:"Learn about best practices for secure and reliable Snaps.",sidebar_position:6},s="Snaps security guidelines",o={unversionedId:"concepts/security-guidelines",id:"concepts/security-guidelines",title:"Snaps security guidelines",description:"Learn about best practices for secure and reliable Snaps.",source:"@site/snaps/concepts/security-guidelines.md",sourceDirName:"concepts",slug:"/concepts/security-guidelines",permalink:"/snaps-security-best-practices/snaps/concepts/security-guidelines",draft:!1,editUrl:"https://github.com/MetaMask/metamask-docs/edit/main/snaps/concepts/security-guidelines.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{description:"Learn about best practices for secure and reliable Snaps.",sidebar_position:6},sidebar:"snapsSidebar",previous:{title:"Snaps design guidelines",permalink:"/snaps-security-best-practices/snaps/concepts/design-guidelines"},next:{title:"About the Keyring API",permalink:"/snaps-security-best-practices/snaps/concepts/keyring-api"}},l={},p=[{value:"Permissions",id:"permissions",level:2},{value:"Transactions",id:"transactions",level:2},{value:"Authorization",id:"authorization",level:2},{value:"Responsible Information Management",id:"responsible-information-management",level:2},{value:"Input Validation",id:"input-validation",level:2},{value:"Using Deprecated APIs or Methods",id:"using-deprecated-apis-or-methods",level:2},{value:"Coding Best Practices",id:"coding-best-practices",level:2},{value:"Dependency Management",id:"dependency-management",level:2},{value:"Publishing and Serving",id:"publishing-and-serving",level:2},{value:"General Rules",id:"general-rules",level:2}],c={toc:p},u="wrapper";function d(e){let{components:t,...r}=e;return(0,i.kt)(u,(0,n.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"snaps-security-guidelines"},"Snaps security guidelines"),(0,i.kt)("p",null,"This page presents essential security principles for builders to develop new Snaps for the MetaMask wallet that are secure and reliable. These guidelines, derived from early Snaps audits, serve as a dynamic handbook, updated as new security-related concepts emerge in the context of Snaps development. Utilize these principles when creating your Snap to ensure it will be safe for users."),(0,i.kt)("h2",{id:"permissions"},"Permissions"),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Guidelines related to the Snap ",(0,i.kt)("a",{parentName:"em",href:"/snaps-security-best-practices/snaps/concepts/anatomy/#manifest-file"},"manifest file")," and its ",(0,i.kt)("a",{parentName:"em",href:"/snaps-security-best-practices/snaps/reference/permissions"},"permissions"),".")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Minimum Permissions:"),' Remember to always follow the principle of "least authority." When requesting or adding permissions in the Snap manifest, make sure to only add the minimum permissions needed by your Snap. Before publishing your Snap, check the permissions again and remove any unused permissions. You can validate your permissions using the ',(0,i.kt)("a",{parentName:"li",href:"https://metamask.github.io/snaps/snaps-simulator/staging/#/manifest"},"Snaps Simulator Manifest Validator"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Minimum RPC access:")," When adding the ",(0,i.kt)("a",{parentName:"li",href:"/snaps-security-best-practices/snaps/reference/permissions/#endowmentrpc"},(0,i.kt)("inlineCode",{parentName:"a"},"endowment:rpc"))," permission for Snaps or dapps, ask yourself if both are really necessary. For example, if permission is granted to communicate with Snaps, it means other Snaps will be able to call your Snap's sensitive RPC methods. "),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Minimum network access:")," Only add the ",(0,i.kt)("a",{parentName:"li",href:"/snaps-security-best-practices/snaps/reference/permissions/#endowmentnetwork-access"},(0,i.kt)("inlineCode",{parentName:"a"},"endowment:network-access"))," permission if it's absolutely necessary, such as when needing to communicate with a remote API that is part of your Snap's functionality. This is because users are rightly concerned about how much of their wallet usage is shared with remote servers. If this permission is needed, inform the user before communicating with remote servers and include a privacy policy in your Snap that explains how data is shared.")),(0,i.kt)("h2",{id:"transactions"},"Transactions"),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Guidelines related to transactions and transaction signing.")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Transaction Details"),': When handling transactions, always present the user with a meaningful prompt displaying all transaction details such as the receiver address, chain ID, network, and amount. Always show the "origin" domain name and "network" to provide the user with a clear context of where the transaction will be used or broadcasted. The user should be aware of the website that originated the transaction request and the blockchain it will be sent to. The receiver address is also crucial to prevent the user from sending funds to the wrong destination.'),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Transparent Signing"),": Always display the message to be signed by the user in the Snap confirmation flow. Do not rely on the requesting website for this, as it could choose not to display it and let the Snap silently sign the message."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Consentful Confirmations"),": Before signing a transaction, always show the user a confirmation prompt with all the transaction details as mentioned above.")),(0,i.kt)("h2",{id:"authorization"},"Authorization"),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Guidelines related to user notifications and authorizations.")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Transparent State Changes"),": The snap should always notify the user about important state changes. The user is then prompted and can decide whether to proceed with a particular action or not.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Consentful Network/Account Switching"),": When the snap switches the Network or the Account, ensure that the user authorizes that action so they are aware of the context switching.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Ensure the User is in Control"),": When modifying or reading internal state, display a confirmation dialog to inform the user of the request and allow them to approve or reject the action.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Consentful Transaction Signing"),": Every time a transaction is about to be signed, prompt the user with the transaction details and provide an option to accept or reject the signature. If your Snap is designed to allow automatic transactions, prompt the user before enabling this and make sure they are aware of how it will work. You should also give the user a way to disable it. ")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Consentful Account Management"),": When deriving or generating keypairs, accounts, or smart contracts, inform the user and ask for their consent.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Protect User Keys"),": Do not allow the Snap to return all the user wallet addresses to the dapp, even public keys. As per MetaMask behavior, only authorized/connected addresses are exposed to the dapp. Users should have the opportunity to choose/authorize only the address(es) they want to expose.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Limit Access to Sensitive Methods"),': If you are building a Snap that has sensitive RPC methods, you probably want to have a dedicated dapp that is used as an "admin interface" to interact with your Snap\'s sensitive methods. There are two ways to do this: '),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"You can restrict the ",(0,i.kt)("inlineCode",{parentName:"p"},"endowment:rpc")," permission to specific URLs using the ",(0,i.kt)("inlineCode",{parentName:"p"},"allowedOrigins")," caveat: "),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-JavaScript"},'{\n  "initialPermissions": {\n    "endowment:rpc": {\n      "allowedOrigins": [\'metamask.io\', \'consensys.io\']\n    }\n  }\n} \n')),(0,i.kt)("p",{parentName:"li"},"In this example, all RPC methods will only be callable by dapps hosted at ",(0,i.kt)("inlineCode",{parentName:"p"},"https://metamask.io")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"https://consensys.io")," (and any subdomains). Calls from any other website will fail.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"You can filter specific methods to specific URLs using the built-in ",(0,i.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/URL"},"URL library"),": "),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-JavaScript"},'const referrer = new URL(origin);\n\nif(referrer.protocol === "https:" && referrer.host.endsWith("metamask.io")) { \n  console.log("URL is valid"); \n}\nelse { \n  console.log("URL is NOT valid"); \n}\n')),(0,i.kt)("p",{parentName:"li"},"In this example, the RPC method can be restricted when the origin matches ",(0,i.kt)("inlineCode",{parentName:"p"},"https://metamask.io")," or any subdomain. This check can be used on any RPC method that should not be callable by all websites."),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Note"),": you should avoid using regular expressions or string matching to filter URLs. The URL library provides a much more reliable interface for matching URLs. "))))),(0,i.kt)("h2",{id:"responsible-information-management"},"Responsible Information Management"),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Guidelines related to handling sensitive data in a Snap.")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Logging:")," Remove all logs to the JavaScript console that contain sensitive information, such as private keys. Furthermore, you should disable all logging before publishing your Snap."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Beware of Errors:")," Be cautious about potential errors/exceptions that could write sensitive information to the console. Review parts of your code where errors/exceptions could be raised. In these cases, error stacks could be written to the console with sensitive information (e.g., a private key). This information could then be captured in data logs, or the user could be phished into copying that console error to be sent to a malicious actor."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Keep Private Keys Private:")," Avoid retrieving the user's private key from the Snap unless absolutely necessary, such as to sign a transaction. If all you need is the user's public key, request it with the method: ",(0,i.kt)("inlineCode",{parentName:"li"},"snap_getBip32PublicKey"),", instead of deriving it from the private key. Never return the private key in an RPC method to a dapp or another Snap. If you want to give users a way to view their private key, you should display it in a dialog rather than exposing it to a dapp."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Limit Exposure:")," Avoid accidentally returning sensitive data from a method. In some cases, a developer may have a method that is supposed to return sensitive data only in specific cases, but due to a typo or bad logic, they end up returning the sensitive data incorrectly, causing potential data leaks. Even if a snap has a legitimate reason for allowing a user to export sensitive data such as a password or private key, the developer should still take extra measures to prevent that information from being revealed carelessly (similar to how MetaMask makes it hard to reveal an SRP and hard for an observer looking over a user\u2019s shoulder to see it). ",(0,i.kt)("em",{parentName:"li"},"When in doubt, choose friction over convenience for sensitive data."))),(0,i.kt)("h2",{id:"input-validation"},"Input Validation"),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Validating RPC parameters and handling values.")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"User Input Validation"),": Always validate and sanitize user inputs coming into the Snap-exposed RPC methods. Be vigilant about validation. Never assume that a parameter is safe to use. If not, and those values are used inside the logic of your Snap methods, a dapp or a user can exploit that logic in an unsafe way.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Obtain Values from MetaMask"),": Always obtain values such as chainId or address from MetaMask instead of the dapp. This is because a dapp could display incorrect values, or a malicious one could phish the user by showing different values with the intention of tricking them into performing actions they wouldn't want to do (for example, signing a transaction for a network they didn't intend to broadcast the transaction to). Furthermore, if the dapp is providing values that do not match the values from MetaMask, you should warn the user in your confirmation flow.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Use ",(0,i.kt)("inlineCode",{parentName:"strong"},"copyable")," for Safe Disclosures"),": When displaying arbitrary content, use ",(0,i.kt)("a",{parentName:"p",href:"/snaps-security-best-practices/snaps/how-to/use-custom-ui/#copyable"},(0,i.kt)("inlineCode",{parentName:"a"},"copyable"))," instead of ",(0,i.kt)("inlineCode",{parentName:"p"},"text"),". A common use case for a snap dialog is to show a confirmation with some arbitrary content, such as for signing a message. One common pitfall when using dialogs is that the input may contain special characters that will render as Markdown and could mislead the user. For example: "),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"Example not using copyable with Markdown rendering",src:a(84822).Z,width:"2000",height:"930"})),(0,i.kt)("p",{parentName:"li"},"The problem is that these special characters: ","*"," and ","_"," may render Markdown formatting and thus what the user sees will not match the content. To avoid this, use\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"copyable"),"\xa0instead:"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"Example using copyable with clean rendering",src:a(53627).Z,width:"2000",height:"930"})),(0,i.kt)("p",{parentName:"li"}," ",(0,i.kt)("inlineCode",{parentName:"p"},"copyable")," does not render Markdown and has the added benefit that the user can click to copy the content. Also, the formatting provides a visual delineator to separate arbitrary input or fields from user interface text.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Transaction Data Size Check"),": Always check the size of a transaction data's function arguments. The encoded transaction data includes the function signature and its arguments. The ABI specification requires that all arguments, regardless of their types, must be 32 bytes in size. If an argument does not have 32 bytes in an ABI-encoded transaction data, the calling contract may behave differently depending on the contract compiler version. For instance, Solidity 0.5.0 treats these non-aligned arguments as invalid and reverts the function call. However, versions before Solidity 0.5.0 automatically append zeros at the end of the transaction data to ensure all arguments are 32-byte sized. An attacker could exploit this feature to bypass any security checks implemented in the corresponding contract function that reads those function arguments."))),(0,i.kt)("h2",{id:"using-deprecated-apis-or-methods"},"Using Deprecated APIs or Methods"),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"List of deprecated methods to avoid.")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Don\u2019t use ",(0,i.kt)("inlineCode",{parentName:"li"},"wallet_enable")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"wallet_invokeSnap")," which was deprecated in favour of ",(0,i.kt)("inlineCode",{parentName:"li"},"wallet_requestSnaps")),(0,i.kt)("li",{parentName:"ul"},"Don\u2019t use ",(0,i.kt)("inlineCode",{parentName:"li"},"snap_confirm")," which was deprecated in favour of ",(0,i.kt)("inlineCode",{parentName:"li"},"snap_dialog")),(0,i.kt)("li",{parentName:"ul"},"Don\u2019t use ",(0,i.kt)("inlineCode",{parentName:"li"},"snap_getBip44Entropy")," with ",(0,i.kt)("inlineCode",{parentName:"li"},"coinType")," 60 - this derivation path is reserved for MetaMask EOA accounts"),(0,i.kt)("li",{parentName:"ul"},"Don\u2019t use ",(0,i.kt)("inlineCode",{parentName:"li"},"endowment:long-running")," which was deprecated for our stable release but was still allowed in Flask")),(0,i.kt)("h2",{id:"coding-best-practices"},"Coding Best Practices"),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Various coding security tips and warnings.")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"SES Compatibility"),": Always use packages or libraries that are compatible with SES (Hardened JavaScript). If not, you may encounter errors that require ",(0,i.kt)("a",{parentName:"li",href:"/snaps-security-best-practices/snaps/how-to/troubleshoot/#patch-dependencies"},"patching a specific dependency")," to fix."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Timers and Side-Channel Attacks"),": Certain JavaScript features like timers (e.g., ",(0,i.kt)("inlineCode",{parentName:"li"},"Date.now"),") can expose critical system information, making a user vulnerable to ",(0,i.kt)("a",{parentName:"li",href:"https://www.rambus.com/blogs/side-channel-attacks/"},"side-channel attacks"),". ",(0,i.kt)("em",{parentName:"li"},"In the Snaps execution environment, the precision of these timers has been reduced to prevent this.")," "),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Unsafe Cryptographic Libraries"),": Avoid using unsafe cryptographic libraries. ",(0,i.kt)("inlineCode",{parentName:"li"},"Math.random")," is not sufficiently random for generating cryptographic hashes, which can expose a user to reverse engineering or brute-forcing keys in the future. Usage of ",(0,i.kt)("inlineCode",{parentName:"li"},"Math.random")," is discouraged in Snaps for any critical random number generation. Insufficient hashing algorithms such as ",(0,i.kt)("inlineCode",{parentName:"li"},"md5")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"sha2")," should also not be used. Use safe hashing algorithms such as ",(0,i.kt)("inlineCode",{parentName:"li"},"sha256"),". Also, avoid using custom or unproven cryptography methods or libraries. ",(0,i.kt)("strong",{parentName:"li"},"Developers should never roll their own cryptography")," or use cryptographic methods that are insufficiently tested. Consider using ",(0,i.kt)("a",{parentName:"li",href:"/snaps-security-best-practices/snaps/reference/rpc-api/#snap_getentropy"},(0,i.kt)("inlineCode",{parentName:"a"},"snap_getEntropy"))," for entropy and consider using the built-in ",(0,i.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/API/Web_Crypto_API"},"Web Crypto API")," or ",(0,i.kt)("a",{parentName:"li",href:"https://paulmillr.com/noble/"},"Noble cryptography libraries"),". ",(0,i.kt)("em",{parentName:"li"},"When in doubt, choose audited, widely used libraries over obscure, untested implementations."))),(0,i.kt)("h2",{id:"dependency-management"},"Dependency Management"),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Best practices for securing your supply chain.")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Pin NPM Package Dependencies:")," Pin all NPM package dependencies in the Snap's dependency tree to exact versions. If not done, a supply chain attack could be used to trick you into including a malicious version of that package instead of the original, legitimate one."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Secure Your Stack:")," Your Snap's companion dapp and any remote servers are part of your security model. Consider using ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/LavaMoat/LavaMoat"},"LavaMoat")," to secure relevant parts of your stack and follow security best practices for your website or server as well. ")),(0,i.kt)("h2",{id:"publishing-and-serving"},"Publishing and Serving"),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Guidelines for making your Snap available to users safely.")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Snap Updates"),": When serving a Snap from a particular website, make sure users are getting the latest version of your Snap. Do not allow any actions on that website before reconnecting it to MetaMask and loading a new or updated version of the Snap. This will prevent users from using outdated versions of the snap that may have potential bugs and security issues."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Snap Publication"),": Ensure correct publication of the Snap. You only need to publish the ",(0,i.kt)("inlineCode",{parentName:"li"},"packages/snap")," folder, not, for example, the entire GitHub repository for a project."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Other Wallet Extensions"),": Be aware that if the user has other wallet extensions installed in the browser, a call to the MetaMask provider ",(0,i.kt)("inlineCode",{parentName:"li"},"window.ethereum")," can be overridden by them. Instead of relying on ",(0,i.kt)("inlineCode",{parentName:"li"},"window.ethereum"),", use EIP-6963 to access the MetaMask provider in a reliable way: ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/MetaMask/snaps/discussions/2001"},"Connecting to Snaps with EIP-6963"),". ")),(0,i.kt)("h2",{id:"general-rules"},"General Rules"),(0,i.kt)("p",null,"In general, when developing new Snaps, you should always put yourself in the user\u2019s shoes and consider their perspective and how they use MetaMask. You should always prioritize their privacy and the security of their assets."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Always inform the user about any action happening in the Snap through the Snap UI, especially for more sensitive actions. This allows the user to decide whether to proceed with a particular action or not. Avoid performing actions in the background, especially when dealing with Snap\u2019s state, private keys, transaction signing, or a user's Personally Identifiable Information (PII). For instance, a Snap RPC method that exports a user\u2019s private key without any feedback to the user (and a way for them to deny it) is a bad practice. A threat actor could exploit this to phish the user into exposing their private key without their knowledge."),(0,i.kt)("li",{parentName:"ul"},"When signing transactions, always warn the user and display all details of the transaction in a clear and understandable format. This allows the user to decide whether to sign it or not and helps prevent scams related to wallet drainage."),(0,i.kt)("li",{parentName:"ul"},"Always display the \u201cOrigin\u201d domain of the dapp that initiated an action in the Snap. This clarifies to the user which dapp is requesting a particular action in the Snap."),(0,i.kt)("li",{parentName:"ul"},"Protect user info and privacy by being careful about what you are sending to external servers. This includes user IPs, emails, and any PII that can uniquely identify the user. Include a privacy policy for maximum transparency."),(0,i.kt)("li",{parentName:"ul"},"Only manipulate a user\u2019s private key if strictly necessary, and especially avoid doing so when dealing with keypairs already managed by MetaMask itself."),(0,i.kt)("li",{parentName:"ul"},"Always use the minimum necessary permissions. This ensures no unforeseen security issues will arise related to \u201cunused\u201d permissions."),(0,i.kt)("li",{parentName:"ul"},'Always keep your Snap source code updated with the latest npm packages and always "pin" specific versions for those packages. This prevents possible security bugs that may arise in outdated versions of packages/libraries and defends against supply chain attacks. ',(0,i.kt)("em",{parentName:"li"},"You can quickly check the status of your dependencies by running ",(0,i.kt)("inlineCode",{parentName:"em"},"npm audit")," in your Snap directory."))),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Have a security best practice not listed here? Share it in our ",(0,i.kt)("a",{parentName:"em",href:"https://github.com/MetaMask/snaps/discussions"},"discussion board"),".")))}d.isMDXComponent=!0},84822:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/copyable-example-1-8827b8ed8f605cd1ef68eed917b64325.png"},53627:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/copyable-example-2-e9bfd44f9fb470673ee306400785317e.png"}}]);